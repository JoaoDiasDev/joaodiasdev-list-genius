@inherits BaseDialog

<MudDialog>
    <DialogContent>
        <MudTextField @bind-Value="GeneralDepartment.Name" Label="Name" Variant="Variant.Outlined"></MudTextField>
    </DialogContent>
    <DialogActions>
        @if (ShowCancelButton)
        {
            <MudButton OnClick="@Cancel">Cancel</MudButton>
        }
        <MudButton Color="@Color" Variant="Variant.Filled" OnClick="@SubmitHandler">@ButtonText</MudButton>
    </DialogActions>
</MudDialog>

@code
{
    [Parameter] public GeneralDepartment GeneralDepartment { get; set; } = new();
    [Parameter] public EventCallback<GeneralDepartment> HandleSaveOperation { get; set; }

    private void Cancel() => CustomMudDialog.Cancel();

    public async void OpenDialog()
    {
        await DisplayGeneralDepartmentDialog(title: "Add GeneralDepartment",
                contentText: "You need to provide GeneralDepartment name.",
                buttonText: "Save",
                color: Color.Success,
                showCancelButton: true);
        StateHasChanged();
    }

    protected override async Task SubmitHandler()
    {
        await Save();
    }

    private async Task Save()
    {
        if (string.IsNullOrEmpty(GeneralDepartment.Name))
        {
            await DisplayBaseDialog(title: "Error",
                contentText: "You need to provide GeneralDepartment name.",
                buttonText: "Close",
                color: Color.Secondary,
                showCancelButton: false);
        }
        else
        {
            await HandleSaveOperation.InvokeAsync(GeneralDepartment);
        }
    }

    private async Task DisplayBaseDialog(string title,
      string contentText,
      string buttonText,
      Color color,
      bool showCancelButton = false)
    {
        var parameters = new DialogParameters<BaseDialog>
        {
            { nameof(ContentText), contentText },
            { nameof(ButtonText), buttonText },
            { nameof(Color), color },
            { nameof(ShowCancelButton), showCancelButton }
        };
        await DialogService.ShowAsync<BaseDialog>(title: title, parameters: parameters);
    }

    private async Task DisplayGeneralDepartmentDialog(string title,
      string contentText,
      string buttonText,
      Color color,
      bool showCancelButton = false)
    {
        var parameters = new DialogParameters<BaseDialog>
        {
            { nameof(ContentText), contentText },
            { nameof(ButtonText), buttonText },
            { nameof(Color), color },
            { nameof(ShowCancelButton), showCancelButton }
        };
        await DialogService.ShowAsync<GeneralDepartmentDialog>(title: title, parameters: parameters);
    }

    public void ChangeTitle(string title)
    {
        CustomMudDialog.SetTitle(title);
    }
}
